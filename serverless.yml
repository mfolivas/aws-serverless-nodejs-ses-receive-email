service: aws-serverless-nodejs-ses-receive-email

frameworkVersion: '2'

provider:
  name: aws
  runtime: nodejs12.x
  lambdaHashingVersion: 20201221
  stage: dev
  region: us-east-1


functions:
  incomingSesEmail:
    handler: handler.hello

  emailValidator:
    handler: handler.acceptReject

resources:
  Resources:
    SESPermissionToLambda:
      Type: AWS::Lambda::Permission
      Properties:
        Action: lambda:InvokeFunction
        FunctionName: 
          "Fn::GetAtt": [ IncomingSesEmailLambdaFunction, Arn ]
        Principal: ses.amazonaws.com
        SourceAccount: 
          Ref: AWS::AccountId
    SESPermissionToInvokeProcessAcceptRejeectLambda:
      Type: AWS::Lambda::Permission
      Properties:
        Action: lambda:InvokeFunction
        FunctionName: 
          "Fn::GetAtt": [ EmailValidatorLambdaFunction, Arn ]
        Principal: ses.amazonaws.com
        SourceAccount: 
          Ref: AWS::AccountId

